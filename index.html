<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini Web Calculator</title>
  <style>
    :root { --bg:#0b0f14; --panel:#121925; --muted:#7a8699; --fg:#e6eefc; --accent:#6aa6ff; --ok:#6be675; --warn:#f4bf4f; --err:#ff6b6b; }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif; background: radial-gradient(1200px 800px at 10% -10%, #1b2433 0%, #0b0f14 55%); color: var(--fg); }
    .wrap { max-width: 900px; margin: 40px auto; padding: 16px; }
    header { display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 18px; }
    h1 { font-size: 1.6rem; margin: 0; letter-spacing: .2px; }
    .card { background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02)); border: 1px solid rgba(255,255,255,0.08); border-radius: 18px; padding: 18px; box-shadow: 0 10px 30px rgba(0,0,0,.25); }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .col-6 { grid-column: span 6; } .col-12 { grid-column: span 12; }
    @media (max-width: 800px) { .col-6 { grid-column: span 12; } }
    label { font-size: .9rem; color: var(--muted); display: block; margin-bottom: 6px; }
    .field { display: flex; align-items: center; gap: 8px; background: #0f1622; border: 1px solid rgba(255,255,255,0.08); border-radius: 12px; padding: 10px 12px; }
    .field input { flex: 1; border: 0; outline: none; background: transparent; color: var(--fg); font-size: 1.05rem; }
    .suffix { color: var(--muted); font-size: .95rem; }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button { background: var(--panel); border: 1px solid rgba(255,255,255,0.12); color: var(--fg); padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 600; }
    button.primary { background: linear-gradient(180deg, #2d5fff, #1b43c9); border-color: transparent; }
    button.ghost { background: transparent; }
    .result { background: #0f1a2a; border: 1px solid rgba(255,255,255,0.08); border-radius: 14px; padding: 12px 14px; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
    .result strong { font-size: 1.2rem; }
    .muted { color: var(--muted); font-size: .9rem; }
    .badge { font-size: .75rem; padding: 3px 8px; border-radius: 999px; border: 1px solid rgba(255,255,255,0.12); color: var(--muted); }
    .ok { color: var(--ok); } .warn { color: var(--warn);} .err { color: var(--err);} 
    .hr { height: 1px; background: rgba(255,255,255,0.08); margin: 14px 0; }
    footer { margin-top: 18px; color: var(--muted); font-size: .85rem; text-align: center; }
    .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0d1320; border:1px solid rgba(255,255,255,0.1); padding:2px 6px; border-radius:6px; }
    details { border: 1px dashed rgba(255,255,255,0.18); border-radius: 12px; padding: 10px 12px; }
    summary { cursor: pointer; color: var(--muted); }
    code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0d1320; border:1px solid rgba(255,255,255,0.08); padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Mini Web Calculator</h1>
      <span class="badge" id="status">Pronto</span>
    </header>

    <div class="card">
      <div class="grid">
        <div class="col-6">
          <h2 style="margin:6px 0 10px 0">Input</h2>
          <div id="inputs"></div>
          <div class="hr"></div>
          <div class="btns">
            <button class="primary" id="btnCalc">Calcola</button>
            <button id="btnReset">Reset</button>
            <button class="ghost" id="btnShare">Condividi stato</button>
          </div>
        </div>
        <div class="col-6">
          <h2 style="margin:6px 0 10px 0">Output</h2>
          <div id="outputs"></div>
          <p class="muted">I valori si aggiornano in tempo reale. Le formule sono definibili nel codice (vedi sotto).</p>
        </div>
      </div>
    </div>

    <details style="margin-top:14px">
      <summary><strong>Come modificare le formule</strong></summary>
      <p>
        Tutto è in questo file. Per adattare il tool, modifica il blocco <code>CONFIG</code> o la funzione <code>compute(model)</code>.
        Come esempio, qui calcoliamo <em>IVA</em> e <em>Prezzo lordo</em> a partire da un prezzo netto.
      </p>
      <pre><code>// Esempio (già attivo in pagina)
const CONFIG = {
  inputs: [
    { id: "netPrice", label: "Prezzo netto", type: "number", step: "0.01", unit: "€" },
    { id: "ivaRate", label: "Aliquota IVA", type: "number", step: "0.1", unit: "%", default: 22 }
  ],
  outputs: [
    { id: "ivaAmount", label: "IVA", unit: "€" },
    { id: "grossPrice", label: "Prezzo lordo", unit: "€" }
  ]
};

function compute(m){
  const net = n(m.netPrice);
  const rate = n(m.ivaRate);
  const iva = net * (rate/100);
  const gross = net + iva;
  return { ivaAmount: iva, grossPrice: gross };
}
</code></pre>
      <p>
        Per aggiungere altri campi, estendi <code>CONFIG.inputs</code> e ritorna nuove proprietà da <code>compute</code>, quindi aggiungile in <code>CONFIG.outputs</code>.
      </p>
    </details>

    <footer>
      Single‑file, senza dipendenze. Salva come <span class="kbd">index.html</span> e apri nel browser o servi con <span class="kbd">python -m http.server 8080</span>.
    </footer>
  </div>

  <script>
    // ====== CONFIGURAZIONE: modifica qui per il tuo caso ======
    const CONFIG = {
      inputs: [
        { id: "netPrice", label: "Prezzo netto", type: "number", step: "0.01", unit: "€" },
        { id: "ivaRate", label: "Aliquota IVA", type: "number", step: "0.1", unit: "%", default: 22 }
      ],
      outputs: [
        { id: "ivaAmount", label: "IVA", unit: "€" },
        { id: "grossPrice", label: "Prezzo lordo", unit: "€" }
      ]
    };

    // Funzione di calcolo: riceve il modello con gli input come numeri
    function compute(model){
      const net = n(model.netPrice);
      const rate = n(model.ivaRate);
      const iva = net * (rate/100);
      const gross = net + iva;
      return { ivaAmount: iva, grossPrice: gross };
    }
    // ============== fine configurazione =======================

    // Util
    const fmt = new Intl.NumberFormat('it-IT', { maximumFractionDigits: 2 });
    const q = (s, el=document) => el.querySelector(s);
    const el = (tag, attrs={}) => Object.assign(document.createElement(tag), attrs);
    const n = (v) => (v === undefined || v === null || v === '' || Number.isNaN(+v)) ? 0 : +v;

    // Stato
    const state = { model: {}, view: {} };

    // Render inputs
    function renderInputs(){
      const root = q('#inputs');
      root.innerHTML = '';
      CONFIG.inputs.forEach(inp => {
        const wrap = el('div');
        const lab = el('label', { htmlFor: inp.id, textContent: inp.label });
        const field = el('div', { className: 'field' });
        const input = el('input', { id: inp.id, type: inp.type || 'text', step: inp.step || 'any', inputmode: inp.type==='number' ? 'decimal' : undefined });
        input.value = getInitialValue(inp);
        field.appendChild(input);
        if (inp.unit) field.appendChild(el('span', { className: 'suffix', textContent: inp.unit }));
        wrap.appendChild(lab);
        wrap.appendChild(field);
        root.appendChild(wrap);
        input.addEventListener('input', () => { state.model[inp.id] = input.value; autosave(); recalc(); });
        state.view[inp.id] = input;
        state.model[inp.id] = input.value;
      });
    }

    // Render outputs
    function renderOutputs(){
      const root = q('#outputs');
      root.innerHTML = '';
      CONFIG.outputs.forEach(o => {
        const row = el('div', { className: 'result', id: `row-${o.id}` });
        const left = el('div');
        const right = el('div');
        left.appendChild(el('div', { className: 'muted', textContent: o.label }));
        const strong = el('strong', { id: o.id, textContent: '-' });
        right.appendChild(strong);
        if (o.unit) right.appendChild(el('span', { className: 'muted', textContent: ' ' + o.unit }));
        row.appendChild(left);
        row.appendChild(right);
        root.appendChild(row);
        state.view[o.id] = strong;
      });
    }

    // Calcolo + UI update
    function recalc(){
      try {
        const numericModel = Object.fromEntries(Object.entries(state.model).map(([k,v]) => [k, n(v)]));
        const out = compute(numericModel) || {};
        CONFIG.outputs.forEach(o => {
          const val = out[o.id];
          state.view[o.id].textContent = (typeof val === 'number') ? fmt.format(val) : (val ?? '-');
        });
        setStatus('Calcolato', 'ok');
      } catch (e) {
        console.error(e);
        setStatus('Errore nel calcolo', 'err');
      }
    }

    function setStatus(text, kind){
      const st = q('#status');
      st.textContent = text;
      st.className = 'badge ' + (kind || '');
    }

    // Stato iniziale da URL o localStorage
    function getInitialValue(inp){
      const params = new URLSearchParams(location.hash.slice(1));
      const ls = JSON.parse(localStorage.getItem('mini-calc') || '{}');
      return params.get(inp.id) ?? ls[inp.id] ?? inp.default ?? '';
    }

    function autosave(){
      const data = {};
      CONFIG.inputs.forEach(inp => { data[inp.id] = state.model[inp.id]; });
      localStorage.setItem('mini-calc', JSON.stringify(data));
    }

    function shareState(){
      const p = new URLSearchParams();
      CONFIG.inputs.forEach(inp => { const v = state.model[inp.id]; if (v !== undefined && v !== '') p.set(inp.id, v); });
      location.hash = p.toString();
      navigator.clipboard?.writeText(location.href).then(() => setStatus('Link copiato', 'ok'));
    }

    // Pulsanti
    function wireButtons(){
      q('#btnCalc').addEventListener('click', recalc);
      q('#btnReset').addEventListener('click', () => { CONFIG.inputs.forEach(inp => { state.model[inp.id] = inp.default ?? ''; state.view[inp.id].value = state.model[inp.id]; }); autosave(); recalc(); });
      q('#btnShare').addEventListener('click', shareState);
    }

    // Avvio
    renderInputs();
    renderOutputs();
    wireButtons();
    recalc();
  </script>
</body>
</html>
